# Paperless-AI ConfigMap
# Story: 14.3 - Integrate Paperless-AI with LiteLLM
# Epic: 14 - LiteLLM Inference Proxy (Three-Tier Fallback)
#
# FRs:
# - FR87: Paperless-AI connects to LLM
# - FR88: LLM-based auto-tagging
# - FR89: Auto-populate correspondents and types
# - FR115: Paperless-AI uses LiteLLM unified endpoint
#
# NFRs:
# - NFR58: 95%+ valid JSON output
# - NFR63: Document classification <5 seconds with GPU inference
# - NFR67: Document processing continues (degraded) via fallback chain
#
# Environment Variables Reference:
# https://github.com/clusterzx/paperless-ai
apiVersion: v1
kind: ConfigMap
metadata:
  name: paperless-ai-config
  namespace: docs
  labels:
    app.kubernetes.io/name: paperless-ai
    app.kubernetes.io/instance: paperless-ai
    app.kubernetes.io/part-of: home-lab
    app.kubernetes.io/managed-by: kubectl
data:
  # Initial setup - enables web UI configuration wizard
  PAPERLESS_AI_INITIAL_SETUP: "yes"

  # Server port - must override K8s service discovery variable collision
  PORT: "3000"

  # Paperless-ngx configuration
  # Service DNS: paperless-paperless-ngx.docs.svc.cluster.local:8000
  PAPERLESS_API_URL: "http://paperless-paperless-ngx.docs.svc.cluster.local:8000/api"
  # RAG service needs base URL without /api suffix
  PAPERLESS_URL: "http://paperless-paperless-ngx.docs.svc.cluster.local:8000"
  PAPERLESS_USERNAME: "tjetzinger"

  # AI Provider configuration - using LiteLLM proxy with three-tier fallback
  AI_PROVIDER: "custom"

  # LiteLLM configuration (unified endpoint with automatic failover)
  # Three-tier fallback: vLLM (GPU) → Ollama (CPU) → OpenAI (cloud)
  # Service DNS: litellm.ml.svc.cluster.local:4000
  CUSTOM_BASE_URL: "http://litellm.ml.svc.cluster.local:4000/v1"
  LLM_MODEL: "vllm-r1"

  # Previous direct vLLM configuration (superseded by LiteLLM)
  # CUSTOM_BASE_URL: "http://vllm-api.ml.svc.cluster.local:8000/v1"
  # LLM_MODEL: "Qwen/Qwen2.5-7B-Instruct-AWQ"

  # Document processing configuration
  SCAN_INTERVAL: "*/30 * * * *"
  PROCESS_PREDEFINED_DOCUMENTS: "yes"
  TAGS: "pre-process"
  ADD_AI_PROCESSED_TAG: "no"
  USE_EXISTING_DATA: "no"
