# Paperless-ngx Helm values for home-lab
# Stories: 10.1-10.9 - Document Management System
# Epic: 10 - Document Management System
#
# FRs:
# - FR8: Deploy applications using Helm charts
# - FR55: Deploy Paperless-ngx with Redis for task queuing
# - FR56: Configure OCR with German and English support
# - FR75: Single-user folder-based organization (Story 10.7)
# - FR76: Duplicate document detection (Story 10.7)
# - FR77: NFS mount from workstation (Story 10.7)
# - FR78: Auto-import within 30 seconds (Story 10.7)
# - FR79: CSRF protection enabled (Story 10.8)
# - FR80: CORS restricted to authorized origins (Story 10.8)
# - FR81: Apache Tika for text extraction (Story 10.9)
# - FR82: Gotenberg for PDF conversion (Story 10.9)
# - FR83: Direct Office format import (Story 10.9)
#
# NFRs:
# - NFR39: NFS polling mode required (inotify incompatible)
# - NFR40: 10-second polling interval
# - NFR41: 2 parallel OCR workers (Story 10.9)
#
# Components: Paperless-ngx (Deployment), Redis (StatefulSet)

# Paperless-ngx image configuration
image:
  repository: ghcr.io/paperless-ngx/paperless-ngx
  pullPolicy: IfNotPresent
  tag: "latest"  # Use latest stable Paperless-ngx version

# Environment variables for Paperless-ngx configuration
# Reference: https://docs.paperless-ngx.com/configuration/
env:
  TZ: Europe/Berlin  # German timezone
  PAPERLESS_URL: "https://paperless.home.jetzinger.com"  # Public-facing URL (Story 10.4)
  PAPERLESS_SECRET_KEY: "placeholder-secret-key"  # Override with --set during deployment
  PAPERLESS_REDIS: "redis://redis:6379"  # Redis connection for standalone deployment

  # PostgreSQL database configuration (Story 10.2)
  PAPERLESS_DBENGINE: postgresql
  PAPERLESS_DBHOST: postgres-postgresql.data.svc.cluster.local  # Cluster PostgreSQL from Epic 5
  PAPERLESS_DBNAME: paperless
  PAPERLESS_DBUSER: paperless_user
  PAPERLESS_DBPORT: "5432"
  PAPERLESS_DBPASS: "placeholder-db-password"  # Override with --set during deployment

  # OCR configuration (Story 10.3)
  PAPERLESS_OCR_LANGUAGE: "deu+eng"  # German + English OCR support
  PAPERLESS_OCR_MODE: "skip"  # Skip OCR if document already has text layer

  # Single-user configuration (Story 10.7: FR75-78, NFR39-40)
  PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS: "true"  # Auto-tag docs by subfolder name (optional organization)
  PAPERLESS_CONSUMER_RECURSIVE: "true"  # Watch subdirectories in /consume
  PAPERLESS_CONSUMER_DELETE_DUPLICATES: "true"  # Prevent duplicate document imports

  # Document organization
  PAPERLESS_FILENAME_FORMAT: "{created_year}/{correspondent}/{title}"  # Organized file structure
  PAPERLESS_FILENAME_FORMAT_REMOVE_NONE: "true"  # Clean filenames

  # Performance optimization
  PAPERLESS_TASK_WORKERS: "2"  # Parallel OCR workers (adjust based on CPU cores)
  PAPERLESS_ENABLE_COMPRESSION: "true"  # Compress archived PDFs to save storage

  # Search optimization
  PAPERLESS_ENABLE_NLTKRE: "true"  # Natural language search support

  # Security hardening
  PAPERLESS_COOKIE_PREFIX: "paperless_ngx"  # Prevent cookie conflicts
  PAPERLESS_CSRF_TRUSTED_ORIGINS: "https://paperless.home.jetzinger.com"  # CSRF protection
  PAPERLESS_CORS_ALLOWED_HOSTS: "https://paperless.home.jetzinger.com"  # CORS security
  PAPERLESS_LOGOUT_REDIRECT_URL: "/"  # Redirect to homepage after logout
  PAPERLESS_ENABLE_HTTP_REMOTE_USER: "false"  # Disable reverse proxy auth (using built-in auth)

  # Office document processing (Story 10.9: FR81-83)
  PAPERLESS_TIKA_ENABLED: "true"  # Enable Apache Tika integration for Office documents
  PAPERLESS_TIKA_ENDPOINT: "http://tika:9998"  # Tika server for text extraction
  PAPERLESS_TIKA_GOTENBERG_ENDPOINT: "http://gotenberg:3000"  # Gotenberg for PDF conversion

  # Data management and consumer settings
  PAPERLESS_CONSUMER_IGNORE_PATTERNS: '[".DS_Store", "._*", ".stfolder", ".stversions", "Thumbs.db", "desktop.ini"]'  # Ignore system files
  PAPERLESS_CONSUMER_POLLING: "10"  # Poll every 10 seconds (required for NFS - inotify doesn't work)
  PAPERLESS_CONSUMER_POLLING_DELAY: "5"  # Wait 5 seconds after file change before consuming
  PAPERLESS_CONSUMER_POLLING_RETRY_COUNT: "5"  # Retry 5 times if file is locked

  # User experience
  PAPERLESS_NUMBER_OF_SUGGESTED_DATES: "3"  # Show top 3 date suggestions when uploading

# Service configuration
service:
  main:
    ports:
      http:
        port: 8000  # Paperless-ngx default port

# Ingress disabled (IngressRoute created in Story 10.4)
ingress:
  main:
    enabled: false

# Persistent storage configuration (Story 10.4 - NFS backend from Epic 2)
# StorageClass: nfs-client (Synology DS920+ at 192.168.2.5:/volume1/k8s-data)
# Capacity planning: NFR29 targets 5,000+ documents (~50GB originals + 20GB media)
persistence:
  data:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 50Gi  # Documents, search index, configuration files
    retain: true
  media:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 20Gi  # Thumbnails, archived versions, document originals
    retain: true
  export:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 5Gi  # Document exports (temporary storage)
    retain: true
  consume:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 5Gi  # Watch directory for auto-import
    retain: true

# PostgreSQL subchart disabled (using existing cluster PostgreSQL from Epic 5)
postgresql:
  enabled: false

# MariaDB database disabled (using PostgreSQL strategy)
mariadb:
  enabled: false

# Redis subchart DISABLED - will deploy standalone Redis instead
redis:
  enabled: false

# Resource limits
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: "2"
    memory: 3Gi

# Pod security context for NFS volume permissions (Story 10.4)
# fsGroup: Changes group ownership of volumes to 1024
# supplementalGroups: Ensures ALL processes keep group 1024, even after dropping privileges
# Note: Paperless drops from root to UID 1000, supplementalGroups preserves group access
podSecurityContext:
  fsGroup: 1024
  fsGroupChangePolicy: "OnRootMismatch"
  supplementalGroups:
    - 1024

# Kubernetes recommended labels
podLabels:
  app.kubernetes.io/name: paperless-ngx
  app.kubernetes.io/instance: paperless
  app.kubernetes.io/part-of: home-lab
  app.kubernetes.io/managed-by: helm
