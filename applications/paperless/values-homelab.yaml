# Paperless-ngx Helm values for home-lab
# Story: 10.1 - Deploy Paperless-ngx with Redis Backend
# Epic: 10 - Document Management System
#
# FRs:
# - FR8: Deploy applications using Helm charts
# - FR55: Deploy Paperless-ngx with Redis for task queuing
# - FR56: Configure OCR with German and English support
#
# Components: Paperless-ngx (Deployment), Redis (StatefulSet)

# Paperless-ngx image configuration
image:
  repository: ghcr.io/paperless-ngx/paperless-ngx
  pullPolicy: IfNotPresent
  tag: "latest"  # Use latest stable Paperless-ngx version

# Environment variables for Paperless-ngx configuration
# Reference: https://docs.paperless-ngx.com/configuration/
env:
  TZ: Europe/Berlin  # German timezone
  PAPERLESS_URL: "https://paperless.home.jetzinger.com"  # Public-facing URL (Story 10.4)
  PAPERLESS_SECRET_KEY: "placeholder-overridden-by-secrets-file"  # Real secret in secrets/paperless-secrets.yaml (gitignored)
  PAPERLESS_REDIS: "redis://redis:6379"  # Redis connection for standalone deployment

  # PostgreSQL database configuration (Story 10.2)
  PAPERLESS_DBENGINE: postgresql
  PAPERLESS_DBHOST: postgres-postgresql.data.svc.cluster.local  # Cluster PostgreSQL from Epic 5
  PAPERLESS_DBNAME: paperless
  PAPERLESS_DBUSER: paperless_user
  PAPERLESS_DBPORT: "5432"
  # PAPERLESS_DBPASS is in secrets/paperless-secrets.yaml (gitignored)

  # OCR configuration (Story 10.3)
  PAPERLESS_OCR_LANGUAGE: "deu+eng"  # German + English OCR support
  PAPERLESS_OCR_MODE: "skip"  # Skip OCR if document already has text layer

# Service configuration
service:
  main:
    ports:
      http:
        port: 8000  # Paperless-ngx default port

# Ingress disabled (IngressRoute created in Story 10.4)
ingress:
  main:
    enabled: false

# Persistent storage configuration (Story 10.4 - NFS backend from Epic 2)
# StorageClass: nfs-client (Synology DS920+ at 192.168.2.5:/volume1/k8s-data)
# Capacity planning: NFR29 targets 5,000+ documents (~50GB originals + 20GB media)
persistence:
  data:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 50Gi  # Documents, search index, configuration files
    retain: true
  media:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 20Gi  # Thumbnails, archived versions, document originals
    retain: true
  export:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 5Gi  # Document exports (temporary storage)
    retain: true
  consume:
    enabled: true
    storageClass: nfs-client
    accessMode: ReadWriteOnce
    size: 5Gi  # Watch directory for auto-import
    retain: true

# PostgreSQL subchart disabled (using existing cluster PostgreSQL from Epic 5)
postgresql:
  enabled: false

# MariaDB database disabled (using PostgreSQL strategy)
mariadb:
  enabled: false

# Redis subchart DISABLED - will deploy standalone Redis instead
redis:
  enabled: false

# Pod security context for NFS volume permissions (Story 10.4)
# fsGroup: Changes group ownership of volumes to 1024
# supplementalGroups: Ensures ALL processes keep group 1024, even after dropping privileges
# Note: Paperless drops from root to UID 1000, supplementalGroups preserves group access
podSecurityContext:
  fsGroup: 1024
  fsGroupChangePolicy: "OnRootMismatch"
  supplementalGroups:
    - 1024

# Kubernetes recommended labels
podLabels:
  app.kubernetes.io/name: paperless-ngx
  app.kubernetes.io/instance: paperless
  app.kubernetes.io/part-of: home-lab
  app.kubernetes.io/managed-by: helm
